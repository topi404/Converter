<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Morphix ‚Äî –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;700;800&display=swap" rel="stylesheet">
<script src="https://js.stripe.com/v3/"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ffmpeg/0.11.6/ffmpeg.min.js"></script>
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #12121a;
    --surface2: #16161f;
    --border: #1e1e2e;
    --accent: #e8ff47;
    --accent2: #ff4757;
    --text: #e8e8f0;
    --muted: #555570;
    --success: #47ffb8;
    --pro: #f0b429;
    --pro-dark: #1a1400;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { background: var(--bg); color: var(--text); font-family: 'Syne', sans-serif; min-height: 100vh; overflow-x: hidden; }
  body::before {
    content: ''; position: fixed; inset: 0; pointer-events: none;
    background-image: linear-gradient(rgba(232,255,71,0.02) 1px, transparent 1px), linear-gradient(90deg, rgba(232,255,71,0.02) 1px, transparent 1px);
    background-size: 60px 60px;
  }

  /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
  header {
    padding: 1.1rem 2.5rem; display: flex; align-items: center; gap: 1.2rem;
    border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 20;
    background: rgba(10,10,15,0.93); backdrop-filter: blur(14px);
  }
  .logo { font-size: 1.35rem; font-weight: 800; letter-spacing: -0.03em; color: var(--accent); white-space: nowrap; }
  .logo span { color: var(--text); }
  .header-right { margin-left: auto; display: flex; align-items: center; gap: 1rem; }
  .ffmpeg-status { display: flex; align-items: center; gap: 0.4rem; font-family: 'Space Mono', monospace; font-size: 0.62rem; color: var(--muted); }
  .ffmpeg-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--muted); transition: background 0.3s; }
  .ffmpeg-dot.ready { background: var(--success); }
  .pro-btn {
    display: flex; align-items: center; gap: 0.4rem;
    background: var(--pro-dark); border: 1px solid var(--pro); color: var(--pro);
    font-family: 'Space Mono', monospace; font-size: 0.62rem; font-weight: 700;
    letter-spacing: 0.07em; padding: 0.3rem 0.8rem; border-radius: 2px;
    cursor: pointer; transition: all 0.15s; white-space: nowrap;
  }
  .pro-btn:hover { background: var(--pro); color: var(--bg); }
  .pro-btn.active { background: var(--pro); color: var(--bg); cursor: default; pointer-events: none; }

  /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
  .hero { max-width: 1100px; margin: 0 auto; padding: 3rem 2rem 1.5rem; }
  .hero h1 { font-size: clamp(2rem, 5vw, 3.2rem); font-weight: 800; line-height: 1.05; letter-spacing: -0.04em; margin-bottom: 0.5rem; }
  .hero h1 em { font-style: normal; color: var(--accent); }
  .hero p { color: var(--muted); font-family: 'Space Mono', monospace; font-size: 0.8rem; margin-bottom: 2.5rem; }

  /* Pro active */
  .pro-active-bar {
    display: none; align-items: center; gap: 0.6rem;
    background: rgba(240,180,41,0.07); border: 1px solid rgba(240,180,41,0.25);
    border-radius: 4px; padding: 0.6rem 1.2rem; margin-bottom: 1.5rem;
    font-family: 'Space Mono', monospace; font-size: 0.7rem; color: var(--pro);
  }
  .pro-active-bar.visible { display: flex; }

  /* ‚îÄ‚îÄ CATEGORY TABS ‚îÄ‚îÄ */
  .cat-tabs {
    display: flex; gap: 0.4rem; flex-wrap: wrap; margin-bottom: 2rem; padding-bottom: 1rem;
    border-bottom: 1px solid var(--border);
  }
  .cat-tab {
    display: flex; align-items: center; gap: 0.4rem;
    padding: 0.45rem 1rem; border-radius: 2px; cursor: pointer;
    background: var(--surface); border: 1px solid var(--border);
    font-family: 'Space Mono', monospace; font-size: 0.68rem; color: var(--muted);
    transition: all 0.15s; white-space: nowrap;
  }
  .cat-tab:hover { border-color: var(--muted); color: var(--text); }
  .cat-tab.active { background: var(--accent); color: var(--bg); border-color: var(--accent); font-weight: 700; }
  .cat-icon { font-size: 0.9rem; }

  /* ‚îÄ‚îÄ CONVERTER PANELS ‚îÄ‚îÄ */
  .panel { display: none; animation: fadeIn 0.2s ease; }
  .panel.active { display: block; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }

  /* ‚îÄ‚îÄ DROPZONE ‚îÄ‚îÄ */
  .dropzone {
    border: 2px dashed var(--border); border-radius: 4px; padding: 2.5rem 2rem;
    text-align: center; cursor: pointer; transition: all 0.2s; position: relative; overflow: hidden; margin-bottom: 1.5rem;
  }
  .dropzone::before {
    content: ''; position: absolute; inset: 0; opacity: 0; transition: opacity 0.3s;
    background: radial-gradient(ellipse at 50% 120%, rgba(232,255,71,0.05) 0%, transparent 70%);
  }
  .dropzone:hover::before, .dropzone.dz-active::before { opacity: 1; }
  .dropzone:hover, .dropzone.dz-active { border-color: var(--accent); border-style: solid; }
  .dz-icon { font-size: 2.2rem; margin-bottom: 0.7rem; display: block; }
  .dz-title { font-size: 1.05rem; font-weight: 700; margin-bottom: 0.3rem; }
  .dz-sub { font-family: 'Space Mono', monospace; font-size: 0.7rem; color: var(--muted); }

  /* ‚îÄ‚îÄ FILE LIST ‚îÄ‚îÄ */
  .section-label {
    font-family: 'Space Mono', monospace; font-size: 0.67rem; color: var(--muted);
    text-transform: uppercase; letter-spacing: 0.12em; margin-bottom: 0.8rem;
    display: flex; align-items: center; gap: 0.5rem;
  }
  .section-label::after { content: ''; flex: 1; height: 1px; background: var(--border); }
  .file-item {
    background: var(--surface); border: 1px solid var(--border); border-radius: 4px;
    padding: 0.8rem 1.1rem; margin-bottom: 0.4rem;
    display: grid; grid-template-columns: auto 1fr auto auto; align-items: center; gap: 0.9rem;
    animation: slideIn 0.2s ease;
  }
  @keyframes slideIn { from { opacity: 0; transform: translateY(-6px); } to { opacity: 1; transform: translateY(0); } }
  .type-badge {
    font-family: 'Space Mono', monospace; font-size: 0.58rem; font-weight: 700;
    padding: 0.18rem 0.4rem; border-radius: 2px; text-transform: uppercase; letter-spacing: 0.04em;
  }
  .tb-image { background: #1a2a4a; color: #47b8ff; }
  .tb-video { background: #2a1a3a; color: #b847ff; }
  .tb-audio { background: #1a3a2a; color: #47ffb8; }
  .tb-doc   { background: #2a1a1a; color: #ff8c47; }
  .tb-unit  { background: #1a2a2a; color: #47e8ff; }
  .file-name { font-size: 0.85rem; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .file-meta { font-family: 'Space Mono', monospace; font-size: 0.65rem; color: var(--muted); }
  .format-select {
    appearance: none; background: var(--bg); border: 1px solid var(--border); color: var(--text);
    font-family: 'Space Mono', monospace; font-size: 0.7rem;
    padding: 0.32rem 1.7rem 0.32rem 0.65rem; border-radius: 2px; cursor: pointer;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='7' viewBox='0 0 10 7'%3E%3Cpath d='M1 1l4 4 4-4' stroke='%23555570' stroke-width='1.5' fill='none'/%3E%3C/svg%3E");
    background-repeat: no-repeat; background-position: right 0.5rem center; transition: border-color 0.15s;
  }
  .format-select:focus { outline: none; border-color: var(--accent); }
  .remove-btn { background: none; border: none; color: var(--muted); cursor: pointer; font-size: 1rem; line-height: 1; padding: 0 0.2rem; transition: color 0.15s; }
  .remove-btn:hover { color: var(--accent2); }

  /* ‚îÄ‚îÄ ACTIONS ‚îÄ‚îÄ */
  .actions { margin-top: 1.5rem; display: flex; gap: 0.8rem; flex-wrap: wrap; align-items: center; }
  .btn { padding: 0.7rem 1.6rem; border: none; border-radius: 2px; font-family: 'Syne', sans-serif; font-weight: 700; font-size: 0.85rem; cursor: pointer; transition: all 0.15s; }
  .btn-primary { background: var(--accent); color: var(--bg); }
  .btn-primary:hover { background: #fff; transform: translateY(-2px); }
  .btn-primary:disabled { background: var(--border); color: var(--muted); cursor: not-allowed; transform: none; }
  .btn-secondary { background: transparent; color: var(--muted); border: 1px solid var(--border); }
  .btn-secondary:hover { border-color: var(--muted); color: var(--text); }

  /* ‚îÄ‚îÄ PROGRESS ‚îÄ‚îÄ */
  .progress-wrap { margin-top: 1.5rem; display: none; }
  .progress-wrap.visible { display: block; }
  .progress-label { font-family: 'Space Mono', monospace; font-size: 0.7rem; color: var(--muted); margin-bottom: 0.4rem; display: flex; justify-content: space-between; }
  .progress-bar { height: 3px; background: var(--border); border-radius: 2px; overflow: hidden; }
  .progress-fill { height: 100%; background: var(--accent); border-radius: 2px; width: 0%; transition: width 0.3s; }

  /* ‚îÄ‚îÄ RESULTS ‚îÄ‚îÄ */
  .results-section { margin-top: 1.8rem; display: none; }
  .results-section.visible { display: block; }
  .result-item {
    background: var(--surface); border: 1px solid var(--success); border-radius: 4px;
    padding: 0.7rem 1.1rem; margin-bottom: 0.4rem;
    display: flex; align-items: center; justify-content: space-between; gap: 1rem;
    animation: slideIn 0.2s ease;
  }
  .result-name { font-size: 0.85rem; font-weight: 700; color: var(--success); }
  .dl-btn {
    padding: 0.28rem 0.75rem; background: var(--success); color: var(--bg);
    border: none; border-radius: 2px; font-family: 'Space Mono', monospace;
    font-size: 0.65rem; font-weight: 700; cursor: pointer; text-decoration: none; transition: opacity 0.15s;
  }
  .dl-btn:hover { opacity: 0.85; }

  /* ‚îÄ‚îÄ UNIT CONVERTER ‚îÄ‚îÄ */
  .unit-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem; }
  .unit-card { background: var(--surface); border: 1px solid var(--border); border-radius: 4px; padding: 1.2rem; }
  .unit-card-title { font-weight: 800; font-size: 0.95rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
  .unit-row { display: flex; gap: 0.5rem; align-items: center; margin-bottom: 0.6rem; }
  .unit-input {
    flex: 1; background: var(--bg); border: 1px solid var(--border); color: var(--text);
    font-family: 'Space Mono', monospace; font-size: 0.8rem; padding: 0.4rem 0.6rem;
    border-radius: 2px; transition: border-color 0.15s;
  }
  .unit-input:focus { outline: none; border-color: var(--accent); }
  .unit-label { font-family: 'Space Mono', monospace; font-size: 0.68rem; color: var(--muted); width: 50px; text-align: right; }
  .unit-arrow { color: var(--muted); font-size: 0.8rem; }

  /* ‚îÄ‚îÄ NOTE ‚îÄ‚îÄ */
  .note {
    max-width: 1100px; margin: 3rem auto 0; padding: 0 2rem 3rem;
    font-family: 'Space Mono', monospace; font-size: 0.68rem; color: var(--muted); line-height: 1.7;
  }
  .note span { color: var(--accent); }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     PRO MODAL
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  .modal-overlay {
    position: fixed; inset: 0; z-index: 100; background: rgba(0,0,0,0.82); backdrop-filter: blur(10px);
    display: flex; align-items: center; justify-content: center; padding: 1rem;
    opacity: 0; pointer-events: none; transition: opacity 0.22s;
  }
  .modal-overlay.open { opacity: 1; pointer-events: all; }
  .modal {
    background: var(--surface); border: 1px solid rgba(240,180,41,0.35); border-radius: 6px;
    width: 100%; max-width: 500px; overflow: hidden;
    transform: translateY(16px) scale(0.97); transition: transform 0.22s ease;
    box-shadow: 0 0 80px rgba(240,180,41,0.08);
  }
  .modal-overlay.open .modal { transform: none; }

  .modal-header { padding: 1.4rem 1.7rem 1rem; border-bottom: 1px solid var(--border); display: flex; align-items: flex-start; justify-content: space-between; }
  .modal-title { font-size: 1.45rem; font-weight: 800; letter-spacing: -0.03em; }
  .modal-title em { font-style: normal; color: var(--pro); }
  .modal-tagline { font-family: 'Space Mono', monospace; font-size: 0.68rem; color: var(--muted); margin-top: 0.2rem; }
  .modal-close { background: none; border: none; color: var(--muted); font-size: 1.2rem; cursor: pointer; transition: color 0.15s; padding: 0.2rem; }
  .modal-close:hover { color: var(--text); }

  .modal-body { padding: 1.4rem 1.7rem; }

  .plans { display: grid; grid-template-columns: 1fr 1fr; gap: 0.7rem; margin-bottom: 1.4rem; }
  .plan {
    border: 1.5px solid var(--border); border-radius: 4px; padding: 1rem;
    cursor: pointer; transition: all 0.15s; position: relative; user-select: none;
  }
  .plan:hover { border-color: var(--pro); }
  .plan.selected { border-color: var(--pro); background: rgba(240,180,41,0.05); }
  .plan-badge { position: absolute; top: -1px; right: -1px; background: var(--pro); color: var(--bg); font-family: 'Space Mono', monospace; font-size: 0.5rem; font-weight: 700; padding: 0.12rem 0.45rem; border-radius: 0 4px 0 2px; letter-spacing: 0.06em; }
  .plan-name { font-weight: 800; font-size: 0.95rem; margin-bottom: 0.15rem; }
  .plan-price { font-family: 'Space Mono', monospace; font-size: 1rem; color: var(--pro); margin-bottom: 0.35rem; }
  .plan-price sub { font-size: 0.58rem; color: var(--muted); }
  .plan-desc { font-family: 'Space Mono', monospace; font-size: 0.6rem; color: var(--muted); line-height: 1.5; }

  .features { list-style: none; border: 1px solid var(--border); border-radius: 4px; overflow: hidden; margin-bottom: 1.4rem; }
  .features li { display: flex; align-items: center; gap: 0.75rem; padding: 0.55rem 0.9rem; border-bottom: 1px solid var(--border); font-size: 0.82rem; }
  .features li:last-child { border-bottom: none; }
  .feat-icon { font-size: 0.9rem; flex-shrink: 0; }
  .feat-label { flex: 1; }
  .feat-free { font-family: 'Space Mono', monospace; font-size: 0.58rem; padding: 0.12rem 0.38rem; background: var(--border); color: var(--muted); border-radius: 2px; }
  .feat-pro  { font-family: 'Space Mono', monospace; font-size: 0.58rem; padding: 0.12rem 0.38rem; background: rgba(240,180,41,0.12); color: var(--pro); border-radius: 2px; }

  .checkout-form { margin-bottom: 1.1rem; display: flex; flex-direction: column; gap: 0.6rem; }
  .field-row { display: grid; grid-template-columns: 1fr 1fr; gap: 0.6rem; }
  .field {
    display: flex; flex-direction: column; gap: 0.3rem;
  }
  .field label { font-family: 'Space Mono', monospace; font-size: 0.6rem; color: var(--muted); letter-spacing: 0.05em; }
  .field input {
    background: var(--bg); border: 1px solid var(--border); color: var(--text);
    font-family: 'Space Mono', monospace; font-size: 0.88rem;
    padding: 0.65rem 0.85rem; border-radius: 3px; transition: border-color 0.2s; width: 100%;
  }
  .field input:focus { outline: none; border-color: var(--pro); }
  .field input::placeholder { color: var(--muted); }
  .field input.error { border-color: var(--accent2); }
  .field-full { grid-column: 1 / -1; }
  .form-error { font-family: 'Space Mono', monospace; font-size: 0.65rem; color: var(--accent2); min-height: 1rem; }
  .card-icons { display: flex; gap: 0.4rem; margin-bottom: 0.2rem; }
  .card-icon { font-size: 1.1rem; opacity: 0.5; }

  .pay-btn {
    width: 100%; padding: 0.85rem; background: var(--pro); color: var(--bg);
    border: none; border-radius: 3px; font-family: 'Syne', sans-serif; font-weight: 800;
    font-size: 0.95rem; cursor: pointer; transition: all 0.15s;
  }
  .pay-btn:hover { background: #fff; }
  .pay-btn:disabled { background: var(--border); color: var(--muted); cursor: not-allowed; }

  .modal-footer { padding: 0.75rem 1.7rem 1.1rem; border-top: 1px solid var(--border); text-align: center; font-family: 'Space Mono', monospace; font-size: 0.6rem; color: var(--muted); }

  @media (max-width: 640px) {
    header { padding: 1rem; }
    .hero { padding: 2rem 1rem 1rem; }
    .file-item { grid-template-columns: auto 1fr auto; }
    .file-meta { display: none; }
    .plans { grid-template-columns: 1fr; }
  }

  /* ‚îÄ‚îÄ STEP NAV ‚îÄ‚îÄ */
  .back-btn {
    background: none; border: 1px solid var(--border); color: var(--muted);
    font-size: 1rem; width: 2rem; height: 2rem; border-radius: 2px;
    cursor: pointer; display: flex; align-items: center; justify-content: center;
    transition: all 0.15s; flex-shrink: 0;
  }
  .back-btn:hover { border-color: var(--text); color: var(--text); }

  /* Plan CTA hint */
  .plan-cta {
    margin-top: 0.6rem; font-family: 'Space Mono', monospace;
    font-size: 0.6rem; color: var(--muted); transition: color 0.15s;
  }
  .plan:hover .plan-cta { color: var(--pro); }
  .plan-featured { border-color: rgba(240,180,41,0.4); background: rgba(240,180,41,0.03); }
  .plan-featured .plan-cta { color: rgba(240,180,41,0.5); }
  .plan-featured:hover .plan-cta { color: var(--pro); }

  /* Card network badges */
  .card-network-row { display: flex; gap: 0.4rem; margin-bottom: 0.4rem; }
  .card-net {
    font-family: 'Space Mono', monospace; font-size: 0.55rem; font-weight: 700;
    border: 1px solid var(--border); color: var(--muted); padding: 0.15rem 0.4rem;
    border-radius: 2px; letter-spacing: 0.06em;
  }

  /* Step slide transition */
  #step-1, #step-2 { animation: fadeIn 0.18s ease; }
</style>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="logo">Mor<span>phix</span></div>
  <div class="header-right">
    <div class="ffmpeg-status" style="display:none">
      <div class="ffmpeg-dot" id="ffmpegDot"></div>
      <span id="ffmpegStatus"></span>
    </div>
    <button class="pro-btn" id="proBtn" onclick="openModal()">‚òÖ Upgrade to Pro</button>
  </div>
</header>

<!-- HERO -->
<div class="hero">
  <h1>–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä <em>–≤—Å–µ–≥–æ.</em></h1>
  <p>// –≤–∏–¥–µ–æ ¬∑ –∞—É–¥–∏–æ ¬∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ¬∑ –¥–æ–∫—É–º–µ–Ω—Ç—ã ¬∑ –∞—Ä—Ö–∏–≤—ã ¬∑ –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è ‚Äî –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ</p>

  <div class="pro-active-bar" id="proBar">‚òÖ Pro –∞–∫—Ç–∏–≤–µ–Ω ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –Ω–∞ –≤—Å–µ—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö</div>

  <!-- CATEGORY TABS -->
  <div class="cat-tabs">
    <div class="cat-tab active" data-panel="video"    onclick="switchCat(this)"><span class="cat-icon">üé¨</span> –í–∏–¥–µ–æ</div>
    <div class="cat-tab"       data-panel="audio"    onclick="switchCat(this)"><span class="cat-icon">üéµ</span> –ê—É–¥–∏–æ</div>
    <div class="cat-tab"       data-panel="image"    onclick="switchCat(this)"><span class="cat-icon">üñºÔ∏è</span> –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
    <div class="cat-tab"       data-panel="doc"      onclick="switchCat(this)"><span class="cat-icon">üìÑ</span> –î–æ–∫—É–º–µ–Ω—Ç—ã</div>
    <div class="cat-tab"       data-panel="unit"     onclick="switchCat(this)"><span class="cat-icon">üìê</span> –ï–¥–∏–Ω–∏—Ü—ã</div>
  </div>

  <!-- ‚îÄ‚îÄ VIDEO PANEL ‚îÄ‚îÄ -->
  <div class="panel active" id="panel-video">
    <div class="dropzone" id="dz-video" onclick="document.getElementById('fi-video').click()">
      <span class="dz-icon">üé¨</span>
      <div class="dz-title">–ü–µ—Ä–µ—Ç–∞—â–∏ –≤–∏–¥–µ–æ-—Ñ–∞–π–ª—ã</div>
      <div class="dz-sub">MP4 ¬∑ WebM ¬∑ AVI ¬∑ MOV ¬∑ MKV ‚Üí –ª—é–±–æ–π –∏–∑ —ç—Ç–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ ¬∑ —Ç–∞–∫–∂–µ Video to GIF</div>
      <input type="file" id="fi-video" hidden multiple accept="video/*,.avi,.mkv,.mov">
    </div>
    <div id="list-video"></div>
    <div class="actions" id="act-video" style="display:none">
      <button class="btn btn-primary" onclick="runConvert('video')">–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
      <button class="btn btn-secondary" onclick="clearFiles('video')">–û—á–∏—Å—Ç–∏—Ç—å</button>
    </div>
    <div class="progress-wrap" id="prog-video">
      <div class="progress-label"><span id="prog-video-lbl">–û–±—Ä–∞–±–æ—Ç–∫–∞...</span><span id="prog-video-pct">0%</span></div>
      <div class="progress-bar"><div class="progress-fill" id="prog-video-fill"></div></div>
    </div>
    <div class="results-section" id="res-video"><div class="section-label">–≥–æ—Ç–æ–≤–æ</div><div id="reslist-video"></div></div>
  </div>

  <!-- ‚îÄ‚îÄ AUDIO PANEL ‚îÄ‚îÄ -->
  <div class="panel" id="panel-audio">
    <div class="dropzone" id="dz-audio" onclick="document.getElementById('fi-audio').click()">
      <span class="dz-icon">üéµ</span>
      <div class="dz-title">–ü–µ—Ä–µ—Ç–∞—â–∏ –∞—É–¥–∏–æ-—Ñ–∞–π–ª—ã</div>
      <div class="dz-sub">MP3 ¬∑ WAV ¬∑ OGG ¬∑ AAC ¬∑ FLAC ¬∑ M4A ¬∑ Opus ‚Üí –ª—é–±–æ–π –∏–∑ —ç—Ç–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤</div>
      <input type="file" id="fi-audio" hidden multiple accept="audio/*,.flac,.opus,.m4a">
    </div>
    <div id="list-audio"></div>
    <div class="actions" id="act-audio" style="display:none">
      <button class="btn btn-primary" onclick="runConvert('audio')">–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
      <button class="btn btn-secondary" onclick="clearFiles('audio')">–û—á–∏—Å—Ç–∏—Ç—å</button>
    </div>
    <div class="progress-wrap" id="prog-audio">
      <div class="progress-label"><span id="prog-audio-lbl">–û–±—Ä–∞–±–æ—Ç–∫–∞...</span><span id="prog-audio-pct">0%</span></div>
      <div class="progress-bar"><div class="progress-fill" id="prog-audio-fill"></div></div>
    </div>
    <div class="results-section" id="res-audio"><div class="section-label">–≥–æ—Ç–æ–≤–æ</div><div id="reslist-audio"></div></div>
  </div>

  <!-- ‚îÄ‚îÄ IMAGE PANEL ‚îÄ‚îÄ -->
  <div class="panel" id="panel-image">
    <div class="dropzone" id="dz-image" onclick="document.getElementById('fi-image').click()">
      <span class="dz-icon">üñºÔ∏è</span>
      <div class="dz-title">–ü–µ—Ä–µ—Ç–∞—â–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
      <div class="dz-sub">JPG ¬∑ PNG ¬∑ WebP ¬∑ BMP ¬∑ GIF ¬∑ AVIF ¬∑ TIFF ‚Üí –ª—é–±–æ–π –∏–∑ —ç—Ç–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ ¬∑ –≤–∫–ª—é—á–∞—è JPG to PDF</div>
      <input type="file" id="fi-image" hidden multiple accept="image/*">
    </div>
    <div id="list-image"></div>
    <div class="actions" id="act-image" style="display:none">
      <button class="btn btn-primary" onclick="runConvert('image')">–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
      <button class="btn btn-secondary" onclick="clearFiles('image')">–û—á–∏—Å—Ç–∏—Ç—å</button>
    </div>
    <div class="progress-wrap" id="prog-image">
      <div class="progress-label"><span id="prog-image-lbl">–û–±—Ä–∞–±–æ—Ç–∫–∞...</span><span id="prog-image-pct">0%</span></div>
      <div class="progress-bar"><div class="progress-fill" id="prog-image-fill"></div></div>
    </div>
    <div class="results-section" id="res-image"><div class="section-label">–≥–æ—Ç–æ–≤–æ</div><div id="reslist-image"></div></div>
  </div>

  <!-- ‚îÄ‚îÄ DOCUMENT PANEL ‚îÄ‚îÄ -->
  <div class="panel" id="panel-doc">
    <div class="dropzone" id="dz-doc" onclick="document.getElementById('fi-doc').click()">
      <span class="dz-icon">üìÑ</span>
      <div class="dz-title">–ü–µ—Ä–µ—Ç–∞—â–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã</div>
      <div class="dz-sub">PDF ¬∑ DOCX ¬∑ TXT ¬∑ EPUB ¬∑ HTML ‚Üí –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ</div>
      <input type="file" id="fi-doc" hidden multiple accept=".pdf,.docx,.txt,.epub,.html,.htm,.md,.rtf">
    </div>
    <div id="list-doc"></div>
    <div class="actions" id="act-doc" style="display:none">
      <button class="btn btn-primary" onclick="runConvert('doc')">–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
      <button class="btn btn-secondary" onclick="clearFiles('doc')">–û—á–∏—Å—Ç–∏—Ç—å</button>
    </div>
    <div class="progress-wrap" id="prog-doc">
      <div class="progress-label"><span id="prog-doc-lbl">–û–±—Ä–∞–±–æ—Ç–∫–∞...</span><span id="prog-doc-pct">0%</span></div>
      <div class="progress-bar"><div class="progress-fill" id="prog-doc-fill"></div></div>
    </div>
    <div class="results-section" id="res-doc"><div class="section-label">–≥–æ—Ç–æ–≤–æ</div><div id="reslist-doc"></div></div>
  </div>

  <!-- ‚îÄ‚îÄ UNIT PANEL ‚îÄ‚îÄ -->
  <div class="panel" id="panel-unit">
    <div class="unit-grid" id="unitGrid"></div>
  </div>
</div><!-- /hero -->

<div class="note">
  <span>–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å:</span> –≤—Å–µ —Ñ–∞–π–ª—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –Ω–∏–∫—É–¥–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è.
</div>

<!-- ‚ïê‚ïê PRO MODAL ‚ïê‚ïê -->
<div class="modal-overlay" id="modalOverlay" onclick="if(event.target===this)closeModal()">
  <div class="modal">

    <!-- STEP 1: –≤—ã–±–æ—Ä –ø–ª–∞–Ω–∞ -->
    <div id="step-1">
      <div class="modal-header">
        <div>
          <div class="modal-title">Morphix <em>Pro</em></div>
          <div class="modal-tagline">// –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –Ω–∞ –≤—Å–µ—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö</div>
        </div>
        <button class="modal-close" onclick="closeModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <ul class="features">
          <li><span class="feat-icon">‚ö°</span><span class="feat-label">–°–∫–æ—Ä–æ—Å—Ç—å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏</span><span class="feat-free">—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è</span></li>
          <li><span class="feat-icon">üíé</span><span class="feat-label">–ö–∞—á–µ—Å—Ç–≤–æ –≤—ã–≤–æ–¥–∞</span><span class="feat-pro">‚òÖ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ</span></li>
          <li><span class="feat-icon">üéûÔ∏è</span><span class="feat-label">–ê—É–¥–∏–æ –±–∏—Ç—Ä–µ–π—Ç</span><span class="feat-pro">‚òÖ –¥–æ 320 kbps</span></li>
          <li><span class="feat-icon">üóúÔ∏è</span><span class="feat-label">–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –¥–æ</span><span class="feat-pro">‚òÖ 2 GB</span></li>
          <li><span class="feat-icon">üì¶</span><span class="feat-label">–ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞</span><span class="feat-pro">‚òÖ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π</span></li>
        </ul>
        <div class="plans">
          <div class="plan" id="plan-m" onclick="goToCheckout('monthly')">
            <div class="plan-name">–ú–µ—Å—è—Ü</div>
            <div class="plan-price">$4.99<sub>/–º–µ—Å</sub></div>
            <div class="plan-desc">–ü–æ–¥–ø–∏—Å–∫–∞ ¬∑ –æ—Ç–º–µ–Ω–∞ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç</div>
            <div class="plan-cta">–í—ã–±—Ä–∞—Ç—å ‚Üí</div>
          </div>
          <div class="plan plan-featured" id="plan-l" onclick="goToCheckout('yearly')">
            <div class="plan-badge">–í–´–ì–û–î–ù–û</div>
            <div class="plan-name">–ì–æ–¥</div>
            <div class="plan-price">$29<sub>/–≥–æ–¥</sub></div>
            <div class="plan-desc">2 –º–µ—Å—è—Ü–∞ –≤ –ø–æ–¥–∞—Ä–æ–∫ ¬∑ –æ–ø–ª–∞—Ç–∞ —Ä–∞–∑ –≤ –≥–æ–¥</div>
            <div class="plan-cta">–í—ã–±—Ä–∞—Ç—å ‚Üí</div>
          </div>
        </div>
      </div>
    </div>

    <!-- STEP 2: —Ñ–æ—Ä–º–∞ –æ–ø–ª–∞—Ç—ã -->
    <div id="step-2" style="display:none">
      <div class="modal-header">
        <div style="display:flex;align-items:center;gap:0.7rem">
          <button class="back-btn" onclick="goBack()">‚Üê</button>
          <div>
            <div class="modal-title" id="step2-title">–û–ø–ª–∞—Ç–∞</div>
            <div class="modal-tagline" id="step2-sub"></div>
          </div>
        </div>
        <button class="modal-close" onclick="closeModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="checkout-form">
          <div class="card-network-row">
            <span class="card-net">VISA</span>
            <span class="card-net">MC</span>
            <span class="card-net">–ú–ò–†</span>
          </div>
          <div class="field">
            <label>Email</label>
            <input type="email" id="f-email" placeholder="you@example.com" autocomplete="email">
          </div>
          <div class="field">
            <label>–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã</label>
            <input type="text" id="f-card" placeholder="0000 0000 0000 0000" maxlength="19" autocomplete="cc-number" oninput="fmtCard(this)">
          </div>
          <div class="field-row">
            <div class="field">
              <label>–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è</label>
              <input type="text" id="f-exp" placeholder="–ú–ú / –ì–ì" maxlength="7" autocomplete="cc-exp" oninput="fmtExp(this)">
            </div>
            <div class="field">
              <label>CVV</label>
              <input type="text" id="f-cvv" placeholder="‚Ä¢‚Ä¢‚Ä¢" maxlength="4" autocomplete="cc-csc" oninput="this.value=this.value.replace(/\D/g,'')">
            </div>
          </div>
          <div class="field">
            <label>–ò–º—è –Ω–∞ –∫–∞—Ä—Ç–µ</label>
            <input type="text" id="f-name" placeholder="IVAN PETROV" autocomplete="cc-name" oninput="this.value=this.value.toUpperCase()">
          </div>
          <div class="form-error" id="form-error"></div>
        </div>
        <button class="pay-btn" id="payBtn" onclick="handlePay()">‚òÖ –û–ø–ª–∞—Ç–∏—Ç—å</button>
      </div>
      <div class="modal-footer">üîí –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Stripe ¬∑ –º—ã –Ω–µ —Ö—Ä–∞–Ω–∏–º –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ</div>
    </div>

  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONFIG ‚Äî –≤—Å—Ç–∞–≤—å URL —Å–≤–æ–µ–≥–æ Vercel –±—ç–∫–µ–Ω–¥–∞
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const API_URL = '–í–°–¢–ê–í–¨_–°–Æ–î–ê_URL_VERCEL'; // –Ω–∞–ø—Ä–∏–º–µ—Ä https://morphix-api.vercel.app

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PRO STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let isPro = localStorage.getItem('morphix_pro') === '1';
function activatePro() {
  isPro = true; localStorage.setItem('morphix_pro', '1');
  document.getElementById('proBtn').textContent = '‚òÖ Pro –∞–∫—Ç–∏–≤–µ–Ω';
  document.getElementById('proBtn').classList.add('active');
  document.getElementById('proBar').classList.add('visible');
}
// –ü–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å–æ Stripe ‚Äî –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º Pro –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —á–µ—Ä–µ–∑ API
const _params = new URLSearchParams(location.search);
if (_params.get('pro') === 'ok') {
  activatePro();
  history.replaceState({}, '', location.pathname);
}
if (isPro) activatePro();

// –ü—Ä–æ–≤–µ—Ä–∫–∞ Pro –ø–æ email –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å–∞–π—Ç–∞ (–µ—Å–ª–∏ –±—ã–ª –∑–∞–ª–æ–≥–∏–Ω–µ–Ω)
const _savedEmail = localStorage.getItem('morphix_email');
if (_savedEmail && !isPro && API_URL && !API_URL.includes('–í–°–¢–ê–í–¨')) {
  fetch(`${API_URL}/api/check-pro?email=${encodeURIComponent(_savedEmail)}`)
    .then(r => r.json())
    .then(d => { if (d.pro) activatePro(); })
    .catch(() => {});
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FORMAT MAPS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const VIDEO_FMTS = ['mp4','webm','avi','mov','mkv','gif'];
const AUDIO_FMTS = ['mp3','wav','ogg','aac','flac','m4a','opus'];
const IMAGE_FMTS = ['jpeg','png','webp','bmp','gif','avif','pdf'];
const DOC_FMTS   = { pdf:['txt','html'], docx:['txt','html'], txt:['html','pdf'], epub:['txt','html'], html:['txt','pdf'], md:['html','txt'], htm:['txt','pdf'], rtf:['txt'] };
const MIME = {
  mp4:'video/mp4', webm:'video/webm', avi:'video/x-msvideo', mov:'video/quicktime', mkv:'video/x-matroska',
  mp3:'audio/mpeg', wav:'audio/wav', ogg:'audio/ogg', aac:'audio/aac', flac:'audio/flac', m4a:'audio/mp4', opus:'audio/opus',
  jpeg:'image/jpeg', png:'image/png', webp:'image/webp', bmp:'image/bmp', gif:'image/gif', avif:'image/avif',
  pdf:'application/pdf', txt:'text/plain', html:'text/html',
};

function formatsForFile(file, cat) {
  const ext = file.name.split('.').pop().toLowerCase();
  if (cat === 'video') return VIDEO_FMTS.filter(f => f !== ext);
  if (cat === 'audio') return AUDIO_FMTS.filter(f => f !== ext);
  if (cat === 'image') return IMAGE_FMTS.filter(f => f !== ext.replace('jpg','jpeg'));
  if (cat === 'doc')   return (DOC_FMTS[ext] || ['txt']);
  return [];
}

function fmtSize(b) {
  if (b < 1024) return b + ' B';
  if (b < 1048576) return (b/1024).toFixed(1) + ' KB';
  if (b < 1073741824) return (b/1048576).toFixed(1) + ' MB';
  return (b/1073741824).toFixed(2) + ' GB';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE PER CATEGORY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const state = { video:[], audio:[], image:[], doc:[] };

function addFiles(cat, rawFiles) {
  rawFiles.forEach(f => {
    const fmts = formatsForFile(f, cat);
    if (!fmts.length) return;
    state[cat].push({ file: f, targetFmt: fmts[0] });
  });
  renderList(cat);
}

function renderList(cat) {
  const container = document.getElementById('list-' + cat);
  const actions   = document.getElementById('act-' + cat);
  container.innerHTML = '';
  if (!state[cat].length) { actions.style.display = 'none'; return; }
  actions.style.display = 'flex';

  const sectionDiv = document.createElement('div');
  sectionDiv.className = 'section-label';
  sectionDiv.textContent = '—Ñ–∞–π–ª—ã';
  container.appendChild(sectionDiv);

  state[cat].forEach((item, i) => {
    const ext = item.file.name.split('.').pop().toLowerCase();
    const fmts = formatsForFile(item.file, cat);
    const opts = fmts.map(f => `<option value="${f}" ${f===item.targetFmt?'selected':''}>${f.toUpperCase()}</option>`).join('');
    const div = document.createElement('div');
    div.className = 'file-item';
    div.innerHTML = `
      <span class="type-badge tb-${cat}">${cat}</span>
      <div><div class="file-name">${item.file.name}</div><div class="file-meta">${fmtSize(item.file.size)}</div></div>
      <select class="format-select" data-i="${i}" data-cat="${cat}">${opts}</select>
      <button class="remove-btn" data-i="${i}" data-cat="${cat}">‚úï</button>
    `;
    container.appendChild(div);
  });

  container.querySelectorAll('.format-select').forEach(s => {
    s.onchange = e => { state[cat][+e.target.dataset.i].targetFmt = e.target.value; };
  });
  container.querySelectorAll('.remove-btn').forEach(b => {
    b.onclick = e => { state[cat].splice(+e.target.dataset.i, 1); renderList(cat); };
  });
}

function clearFiles(cat) {
  state[cat] = []; renderList(cat);
  document.getElementById('res-' + cat).classList.remove('visible');
  document.getElementById('prog-' + cat).classList.remove('visible');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DRAG & DROP per panel
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
['video','audio','image','doc'].forEach(cat => {
  const dz = document.getElementById('dz-' + cat);
  const fi = document.getElementById('fi-' + cat);
  dz.addEventListener('dragover', e => { e.preventDefault(); dz.classList.add('dz-active'); });
  dz.addEventListener('dragleave', () => dz.classList.remove('dz-active'));
  dz.addEventListener('drop', e => { e.preventDefault(); dz.classList.remove('dz-active'); addFiles(cat, [...e.dataTransfer.files]); });
  fi.addEventListener('change', () => { addFiles(cat, [...fi.files]); fi.value = ''; });
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FFMPEG
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let ff = null;
async function ensureFF() {
  if (ff) return;
  const { createFFmpeg, fetchFile } = FFmpeg;
  ff = createFFmpeg({ log: false });
  await ff.load();
  window._ffc = fetchFile;
}

async function convertAV(file, fmt, cat) {
  await ensureFF();
  const inExt  = file.name.split('.').pop().toLowerCase();
  const inName = `in.${inExt}`, outName = `out.${fmt}`;
  ff.FS('writeFile', inName, await window._ffc(file));

  let args;
  if (cat === 'video' && fmt === 'gif') {
    args = ['-i', inName, '-vf', 'fps=12,scale=480:-1:flags=lanczos', '-loop', '0', outName];
  } else if (cat === 'video') {
    const preset = isPro ? ['slow','-crf','17'] : ['fast','-crf','23'];
    args = ['-i', inName, '-preset', preset[0], ...(preset.length>1 ? [preset[1], preset[2]] : []), outName];
  } else {
    const br = isPro ? '320k' : '192k';
    args = ['-i', inName, '-b:a', br, outName];
  }

  await ff.run(...args);
  const data = ff.FS('readFile', outName);
  try { ff.FS('unlink', inName); ff.FS('unlink', outName); } catch(e) {}
  return new Blob([data.buffer], { type: MIME[fmt] || 'application/octet-stream' });
}

// Image convert
function convertImage(file, fmt) {
  return new Promise((resolve, reject) => {
    if (fmt === 'pdf') {
      // Simple image-in-PDF via canvas + data URL
      const img = new Image(), url = URL.createObjectURL(file);
      img.onload = () => {
        const w = img.width, h = img.height;
        // minimal PDF with embedded JPEG
        const canvas = document.createElement('canvas');
        canvas.width = w; canvas.height = h;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0);
        URL.revokeObjectURL(url);
        canvas.toBlob(blob => {
          const reader = new FileReader();
          reader.onload = () => {
            const b64 = reader.result.split(',')[1];
            const pdfBytes = buildImagePdf(b64, w, h);
            resolve(new Blob([pdfBytes], { type: 'application/pdf' }));
          };
          reader.readAsDataURL(blob);
        }, 'image/jpeg', 0.92);
      };
      img.onerror = () => reject(new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ'));
      img.src = url;
      return;
    }
    const img = new Image(), url = URL.createObjectURL(file);
    img.onload = () => {
      const c = document.createElement('canvas');
      c.width = img.width; c.height = img.height;
      const ctx = c.getContext('2d');
      if (fmt === 'jpeg') { ctx.fillStyle = '#fff'; ctx.fillRect(0, 0, c.width, c.height); }
      ctx.drawImage(img, 0, 0);
      URL.revokeObjectURL(url);
      c.toBlob(blob => blob ? resolve(blob) : reject(new Error('–û—à–∏–±–∫–∞')), MIME[fmt] || 'image/png', isPro ? 0.97 : 0.88);
    };
    img.onerror = () => reject(new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ'));
    img.src = url;
  });
}

function buildImagePdf(jpegB64, w, h) {
  const pw = Math.round(w * 0.75), ph = Math.round(h * 0.75); // px ‚Üí pt
  const img = atob(jpegB64);
  let body = '';
  body += '%PDF-1.4\n';
  body += '1 0 obj<</Type/Catalog/Pages 2 0 R>>endobj\n';
  body += '2 0 obj<</Type/Pages/Kids[3 0 R]/Count 1>>endobj\n';
  body += `3 0 obj<</Type/Page/Parent 2 0 R/MediaBox[0 0 ${pw} ${ph}]/Contents 4 0 R/Resources<</XObject<</I1 5 0 R>>>>>>endobj\n`;
  const stream = `q ${pw} 0 0 ${ph} 0 0 cm /I1 Do Q`;
  body += `4 0 obj<</Length ${stream.length}>>stream\n${stream}\nendstream endobj\n`;
  body += `5 0 obj<</Type/XObject/Subtype/Image/Width ${w}/Height ${h}/ColorSpace/DeviceRGB/BitsPerComponent 8/Filter/DCTDecode/Length ${img.length}>>stream\n`;
  const pdfArr = [];
  for (let i = 0; i < body.length; i++) pdfArr.push(body.charCodeAt(i));
  for (let i = 0; i < img.length; i++) pdfArr.push(img.charCodeAt(i));
  const tail = '\nendstream endobj\nxref\n0 6\ntrailer<</Size 6/Root 1 0 R>>\n%%EOF';
  for (let i = 0; i < tail.length; i++) pdfArr.push(tail.charCodeAt(i));
  return new Uint8Array(pdfArr);
}

// Doc convert (best-effort in-browser)
async function convertDoc(file, fmt) {
  const text = await file.text();
  let out = '';
  const ext = file.name.split('.').pop().toLowerCase();
  if (fmt === 'txt') {
    out = text.replace(/<[^>]+>/g, '').replace(/&nbsp;/g, ' ').replace(/&lt;/g, '<').replace(/&gt;/g, '>');
  } else if (fmt === 'html') {
    if (ext === 'txt' || ext === 'md') {
      // Markdown-ish ‚Üí HTML
      let html = text
        .replace(/^### (.+)/gm, '<h3>$1</h3>')
        .replace(/^## (.+)/gm, '<h2>$1</h2>')
        .replace(/^# (.+)/gm, '<h1>$1</h1>')
        .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.+?)\*/g, '<em>$1</em>')
        .replace(/\n\n/g, '</p><p>')
        .replace(/\n/g, '<br>');
      out = `<!DOCTYPE html><html><head><meta charset="UTF-8"><style>body{font-family:sans-serif;max-width:800px;margin:2rem auto;line-height:1.7}</style></head><body><p>${html}</p></body></html>`;
    } else {
      out = text;
    }
  } else if (fmt === 'pdf') {
    // Text ‚Üí simple PDF
    const lines = text.split('\n').slice(0, 200);
    let stream = '';
    stream += 'BT /F1 12 Tf 40 780 Td 14 TL\n';
    lines.forEach(line => {
      const safe = line.replace(/\\/g, '\\\\').replace(/\(/g, '\\(').replace(/\)/g, '\\)').slice(0, 100);
      stream += `(${safe}) Tj T*\n`;
    });
    stream += 'ET';
    let pdf = '%PDF-1.4\n';
    pdf += '1 0 obj<</Type/Catalog/Pages 2 0 R>>endobj\n';
    pdf += '2 0 obj<</Type/Pages/Kids[3 0 R]/Count 1>>endobj\n';
    pdf += '3 0 obj<</Type/Page/Parent 2 0 R/MediaBox[0 0 595 842]/Contents 4 0 R/Resources<</Font<</F1<</Type/Font/Subtype/Type1/BaseFont/Helvetica>>>>>>>>> endobj\n';
    pdf += `4 0 obj<</Length ${stream.length}>>stream\n${stream}\nendstream endobj\n`;
    pdf += 'xref\n0 5\ntrailer<</Size 5/Root 1 0 R>>\n%%EOF';
    return new Blob([pdf], { type: 'application/pdf' });
  }
  return new Blob([out], { type: MIME[fmt] || 'text/plain' });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RUN CONVERT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function runConvert(cat) {
  const items = state[cat];
  if (!items.length) return;

  const progWrap = document.getElementById('prog-' + cat);
  const progFill = document.getElementById('prog-' + cat + '-fill');
  const progLbl  = document.getElementById('prog-' + cat + '-lbl');
  const progPct  = document.getElementById('prog-' + cat + '-pct');
  const resSection = document.getElementById('res-' + cat);
  const resList    = document.getElementById('reslist-' + cat);

  resList.innerHTML = '';
  resSection.classList.remove('visible');
  progWrap.classList.add('visible');

  // Size limit: 500MB free, 2GB pro
  const sizeLimit = isPro ? 2 * 1024 * 1024 * 1024 : 500 * 1024 * 1024;

  const results = [];
  for (let i = 0; i < items.length; i++) {
    const { file, targetFmt } = items[i];
    progFill.style.width = Math.round(i / items.length * 100) + '%';
    progPct.textContent  = Math.round(i / items.length * 100) + '%';
    progLbl.textContent  = `${file.name} ‚Üí .${targetFmt}`;
    const base = file.name.replace(/\.[^.]+$/, '');

    if (file.size > sizeLimit) {
      results.push({ name: file.name, error: `–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–ª–∏–º–∏—Ç ${isPro ? '2 GB' : '500 MB'})${!isPro ? ' ‚Äî –ø–æ–≤—ã—Å—å—Ç–µ –ø–ª–∞–Ω –¥–æ Pro' : ''}` });
      continue;
    }

    try {
      let blob;
      if (cat === 'image') blob = await convertImage(file, targetFmt);
      else if (cat === 'doc') blob = await convertDoc(file, targetFmt);
      else blob = await convertAV(file, targetFmt, cat);
      results.push({ name: `${base}.${targetFmt}`, blob });
    } catch(e) {
      results.push({ name: file.name, error: e.message });
    }
  }

  progFill.style.width = '100%'; progPct.textContent = '100%'; progLbl.textContent = '–ì–æ—Ç–æ–≤–æ!';

  results.forEach(r => {
    const div = document.createElement('div');
    div.className = 'result-item';
    if (r.error) {
      div.style.borderColor = 'var(--accent2)';
      div.innerHTML = `<span class="result-name" style="color:var(--accent2)">${r.name}</span><span style="font-family:'Space Mono',monospace;font-size:.65rem;color:var(--muted)">${r.error}</span>`;
    } else {
      const url = URL.createObjectURL(r.blob);
      div.innerHTML = `<span class="result-name">${r.name}</span><a href="${url}" download="${r.name}" class="dl-btn">‚Üì –°–∫–∞—á–∞—Ç—å</a>`;
    }
    resList.appendChild(div);
  });

  resSection.classList.add('visible');
  setTimeout(() => progWrap.classList.remove('visible'), 1800);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CATEGORY SWITCH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function switchCat(el) {
  document.querySelectorAll('.cat-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('panel-' + el.dataset.panel).classList.add('active');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UNIT CONVERTER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const UNITS = [
  { title: '‚öñÔ∏è –í–µ—Å', pairs: [
    { from: '–ö–∏–ª–æ–≥—Ä–∞–º–º (kg)', to: '–§—É–Ω—Ç (lbs)',     ratio: 2.20462 },
    { from: '–§—É–Ω—Ç (lbs)',     to: '–ö–∏–ª–æ–≥—Ä–∞–º–º (kg)', ratio: 0.453592 },
    { from: '–ì—Ä–∞–º–º (g)',      to: '–£–Ω—Ü–∏—è (oz)',      ratio: 0.035274 },
  ]},
  { title: 'üìè –î–ª–∏–Ω–∞', pairs: [
    { from: '–ú–µ—Ç—Ä (m)',       to: '–§—É—Ç (ft)',        ratio: 3.28084 },
    { from: '–§—É—Ç (ft)',       to: '–ú–µ—Ç—Ä (m)',        ratio: 0.3048 },
    { from: '–ö–∏–ª–æ–º–µ—Ç—Ä (km)', to: '–ú–∏–ª—è (mi)',        ratio: 0.621371 },
    { from: '–°–∞–Ω—Ç–∏–º–µ—Ç—Ä (cm)',to: '–î—é–π–º (in)',        ratio: 0.393701 },
  ]},
  { title: 'üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞', pairs: [
    { from: '–¶–µ–ª—å—Å–∏–π (¬∞C)',  to: '–§–∞—Ä–µ–Ω–≥–µ–π—Ç (¬∞F)', custom: c => c * 9/5 + 32 },
    { from: '–§–∞—Ä–µ–Ω–≥–µ–π—Ç (¬∞F)',to: '–¶–µ–ª—å—Å–∏–π (¬∞C)',   custom: f => (f - 32) * 5/9 },
    { from: '–¶–µ–ª—å—Å–∏–π (¬∞C)',  to: '–ö–µ–ª—å–≤–∏–Ω (K)',     custom: c => c + 273.15 },
  ]},
  { title: 'üíæ –î–∞–Ω–Ω—ã–µ', pairs: [
    { from: '–ì–∏–≥–∞–±–∞–π—Ç (GB)', to: '–ú–µ–≥–∞–±–∞–π—Ç (MB)',   ratio: 1024 },
    { from: '–ú–µ–≥–∞–±–∞–π—Ç (MB)', to: '–ì–∏–≥–∞–±–∞–π—Ç (GB)',   ratio: 1/1024 },
    { from: '–¢–µ—Ä–∞–±–∞–π—Ç (TB)', to: '–ì–∏–≥–∞–±–∞–π—Ç (GB)',   ratio: 1024 },
  ]},
  { title: 'üöÄ –°–∫–æ—Ä–æ—Å—Ç—å', pairs: [
    { from: '–∫–º/—á (kph)',    to: '–º/—Å (m/s)',       ratio: 0.277778 },
    { from: '–ú–∏–ª—è/—á (mph)',  to: '–∫–º/—á (kph)',      ratio: 1.60934 },
    { from: '–£–∑–µ–ª (knot)',   to: '–∫–º/—á (kph)',      ratio: 1.852 },
  ]},
  { title: 'üìê –ü–ª–æ—â–∞–¥—å', pairs: [
    { from: '–ì–µ–∫—Ç–∞—Ä (ha)',   to: '–ê–∫—Ä (acre)',       ratio: 2.47105 },
    { from: '–º¬≤ (m¬≤)',       to: '—Ñ—É—Ç¬≤ (ft¬≤)',       ratio: 10.7639 },
    { from: '–∫–º¬≤ (km¬≤)',     to: '–ú–∏–ª—è¬≤ (mi¬≤)',      ratio: 0.386102 },
  ]},
];

function buildUnits() {
  const grid = document.getElementById('unitGrid');
  UNITS.forEach(group => {
    const card = document.createElement('div');
    card.className = 'unit-card';
    let html = `<div class="unit-card-title">${group.title}</div>`;
    group.pairs.forEach((pair, pi) => {
      const id = `u_${group.title.replace(/\W/g,'')}_${pi}`;
      html += `<div class="unit-row">
        <input class="unit-input" id="${id}_a" type="number" placeholder="0" oninput="calcUnit(this, '${id}', ${JSON.stringify(pair)})">
        <span class="unit-label" style="font-size:0.55rem;width:60px">${pair.from.split('(')[0].trim()}</span>
        <span class="unit-arrow">‚Üí</span>
        <input class="unit-input" id="${id}_b" type="number" placeholder="0" oninput="calcUnitRev(this, '${id}', ${JSON.stringify(pair)})">
        <span class="unit-label" style="font-size:0.55rem;width:60px">${pair.to.split('(')[0].trim()}</span>
      </div>`;
    });
    card.innerHTML = html;
    grid.appendChild(card);
  });
}

function calcUnit(el, id, pair) {
  const v = parseFloat(el.value);
  const out = document.getElementById(id + '_b');
  if (isNaN(v)) { out.value = ''; return; }
  out.value = pair.custom ? round(pair.custom(v)) : round(v * pair.ratio);
}
function calcUnitRev(el, id, pair) {
  const v = parseFloat(el.value);
  const out = document.getElementById(id + '_a');
  if (isNaN(v)) { out.value = ''; return; }
  if (pair.custom) {
    // Reverse: if custom is C‚ÜíF then reverse is F‚ÜíC
    if (pair.from.includes('¬∞C') && pair.to.includes('¬∞F')) out.value = round((v - 32) * 5/9);
    else if (pair.from.includes('¬∞F') && pair.to.includes('¬∞C')) out.value = round(v * 9/5 + 32);
    else if (pair.from.includes('¬∞C') && pair.to.includes('K')) out.value = round(v - 273.15);
    else out.value = round(pair.custom(v));
  } else {
    out.value = round(v / pair.ratio);
  }
}
function round(n) { return Math.round(n * 1e6) / 1e6; }

buildUnits();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STRIPE MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let selPlan = 'monthly';

function openModal() {
  if (isPro) return;
  document.getElementById('step-1').style.display = 'block';
  document.getElementById('step-2').style.display = 'none';
  document.getElementById('modalOverlay').classList.add('open');
}
function closeModal() { document.getElementById('modalOverlay').classList.remove('open'); }

function selectPlan(p) {
  selPlan = p;
}

function goToCheckout(p) {
  selPlan = p;
  const labels = {
    monthly: { title: '–ü–æ–¥–ø–∏—Å–∫–∞ ¬∑ $4.99/–º–µ—Å', sub: '–û—Ç–º–µ–Ω–∞ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç' },
    yearly:  { title: '–ì–æ–¥–æ–≤–æ–π –ø–ª–∞–Ω ¬∑ $29/–≥–æ–¥', sub: '2 –º–µ—Å—è—Ü–∞ –≤ –ø–æ–¥–∞—Ä–æ–∫' },
  };
  document.getElementById('step2-title').textContent = labels[p].title;
  document.getElementById('step2-sub').textContent   = labels[p].sub;
  document.getElementById('step-1').style.display = 'none';
  document.getElementById('step-2').style.display = 'block';
  setTimeout(() => document.getElementById('f-email').focus(), 50);
}

function goBack() {
  document.getElementById('step-2').style.display = 'none';
  document.getElementById('step-1').style.display = 'block';
}

function fmtCard(el) {
  let v = el.value.replace(/\D/g, '').slice(0, 16);
  el.value = v.replace(/(\d{4})(?=\d)/g, '$1 ');
}
function fmtExp(el) {
  let v = el.value.replace(/\D/g, '').slice(0, 4);
  if (v.length >= 3) v = v.slice(0,2) + ' / ' + v.slice(2);
  el.value = v;
}

function validateForm() {
  const email = document.getElementById('f-email').value.trim();
  const card  = document.getElementById('f-card').value.replace(/\s/g,'');
  const exp   = document.getElementById('f-exp').value.replace(/\s/g,'').replace('/','');
  const cvv   = document.getElementById('f-cvv').value.trim();
  const name  = document.getElementById('f-name').value.trim();
  const err   = document.getElementById('form-error');

  // Clear errors
  ['f-email','f-card','f-exp','f-cvv','f-name'].forEach(id => document.getElementById(id).classList.remove('error'));
  err.textContent = '';

  if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
    document.getElementById('f-email').classList.add('error');
    err.textContent = '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email'; return false;
  }
  if (card.length < 13 || card.length > 16) {
    document.getElementById('f-card').classList.add('error');
    err.textContent = '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã'; return false;
  }
  if (exp.length !== 4) {
    document.getElementById('f-exp').classList.add('error');
    err.textContent = '–í–≤–µ–¥–∏—Ç–µ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (–ú–ú/–ì–ì)'; return false;
  }
  const month = parseInt(exp.slice(0,2));
  if (month < 1 || month > 12) {
    document.getElementById('f-exp').classList.add('error');
    err.textContent = '–ú–µ—Å—è—Ü –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 01 –¥–æ 12'; return false;
  }
  if (cvv.length < 3) {
    document.getElementById('f-cvv').classList.add('error');
    err.textContent = '–í–≤–µ–¥–∏—Ç–µ CVV (3‚Äì4 —Ü–∏—Ñ—Ä—ã)'; return false;
  }
  if (!name) {
    document.getElementById('f-name').classList.add('error');
    err.textContent = '–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∫–∞–∫ –Ω–∞ –∫–∞—Ä—Ç–µ'; return false;
  }
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º email –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ Pro —Å—Ç–∞—Ç—É—Å–∞
  localStorage.setItem('morphix_email', email);
  return true;
}

async function handlePay() {
  if (!validateForm()) return;

  const email = document.getElementById('f-email').value.trim();
  const btn   = document.getElementById('payBtn');
  const err   = document.getElementById('form-error');

  btn.disabled = true;
  btn.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞...';

  // Dev mode
  if (!API_URL || API_URL.includes('–í–°–¢–ê–í–¨')) {
    setTimeout(() => { activatePro(); closeModal(); btn.disabled = false; btn.textContent = '‚òÖ –û–ø–ª–∞—Ç–∏—Ç—å'; }, 1200);
    return;
  }

  try {
    const res  = await fetch(`${API_URL}/api/create-checkout`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, plan: selPlan }),
    });
    const data = await res.json();
    if (data.url) {
      window.location.href = data.url; // —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ Stripe Checkout
    } else {
      throw new Error(data.error || '–û—à–∏–±–∫–∞');
    }
  } catch (e) {
    err.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É –æ–ø–ª–∞—Ç—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.';
    btn.disabled = false;
    btn.textContent = '‚òÖ –û–ø–ª–∞—Ç–∏—Ç—å';
  }
}

document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });
</script>
</body>
</html>
